#!/usr/bin/env python

import argparse
import json

from spellvardetection.lib.util import evaluate

parser = argparse.ArgumentParser()
parser.add_argument('gold_file')
parser.add_argument('prediction_file')
parser.add_argument('--dict_file')
parser.add_argument('--known_file')
parser.add_argument('--freq_file')
args = parser.parse_args()

tokens = json.load(open(args.gold_file, 'r'))
predictions_type = json.load(open(args.prediction_file, 'r'))

# add type-based predictions to tokens
tokens = [{**token, **{'filtered_candidates': predictions_type.get(token['type'], [])}} for token in tokens]

dictionary = set()
if args.dict_file:
    dictionary = set(json.load(open(args.dict_file, 'r')))

known_dict = set()
if args.known_file:
    known_dict = set(json.load(open(args.known_file, 'r')))

freq_dict = {}
if args.freq_file:
    freq_dict = json.load(open(args.freq_file, 'r'))

print(evaluate(tokens, dictionary, known_dict, freq_dict))
