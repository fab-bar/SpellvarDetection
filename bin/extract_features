#!/usr/bin/env python

import argparse
import json

from spellvardetection.util.learn_simplification_rules import getPairsFromSpellvardict
from spellvardetection.type_filter import createFeatureExtractor

parser = argparse.ArgumentParser()
parser.add_argument('feature_extractors')
parser.add_argument('spellvardict')
parser.add_argument('outfile')
args = parser.parse_args()


spellvarpairs = getPairsFromSpellvardict(json.load(open(args.spellvardict, 'r')))

feature_cache = dict()

for extractor in json.loads(args.feature_extractors):

    extractor_type = extractor['type']
    extractor_key = extractor['key']
    options = extractor.get('options', {})

    feature_extractor = createFeatureExtractor(extractor_type, options)
    feature_extractor.setFeatureCache(feature_cache, key=extractor_key)
    feature_extractor.extractFeatures(spellvarpairs)

json.dump(feature_cache, open(args.outfile, 'w'))
